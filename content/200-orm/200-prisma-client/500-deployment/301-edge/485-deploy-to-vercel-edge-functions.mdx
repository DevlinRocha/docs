---
title: 'Deploy to Vercel Edge Functions'
metaTitle: 'Deploy to Vercel Edge Functions'
metaDescription: 'Learn the things you need to know in order to deploy an Edge function that uses Prisma Client for talking to a database.'
tocDepth: 3
---

<TopBlock>

This page covers the things you need to know in order to deploy an Edge function to [Vercel Edge Functions](https://vercel.com/docs/functions/edge-functions) that uses Prisma Client for talking to a database.

</TopBlock>

## General considerations when deploying to Vercel Edge Functions

### Using an edge-compatible driver

**Note**: [Prisma Accelerate](/acccelerate) enables you to access _any_ database from _any_ edge function provider. No edge-compatible driver is necessary.

When deploying a Vercel Edge Function that uses Prisma ORM, you need to use an [edge-compatible driver]() and its respective [driver adapter]() for Prisma ORM.

The edge-compatible drivers for Cloudflare Workers are:

- [Neon Serverless](https://neon.tech/docs/serverless/serverless-driver) uses HTTP to access the database
- [PlanetScale Serverless](https://planetscale.com/docs/tutorials/planetscale-serverless-driver) uses HTTP to access the database
- [`node-postgres`](https://node-postgres.com/) (`pg`) uses Cloudflare's `connect()` (TCP) to access the database

> **Note**: There's [also work being done](https://github.com/sidorares/node-mysql2/pull/2289) on the `node-mysql2` driver which will enable to access traditional MySQL databases from edge functions as well.

### Setting your database connection URL as an environment variable

First, ensure that the `DATABASE_URL` is set as the `url` of the `datasource` in your Prisma schema:

```prisma
datasource db {
  provider = "postgresql" // this might also be `mysql` or another value depending on your database
  url      = env("DATABASE_URL")
}
```

#### Development

When in **development**, you can configure your database connection via the `DATABASE_URL` environment variable (e.g. [using `.env` files](/orm/more/development-environment/environment-variables/env-files)).

#### Production

When deploying your Edge Function to **production**, you'll need to set the database connection using the `vercel` CLI:

```terminal
npx vercel env add DATABASE_URL your-database-connection-string
```

In the above snippet, `your-database-connection-string` is a placeholder that you need to replace with the value of your own connection string, for example:

```terminal
npx vercel env add DATABASE_URL postgresql://admin:mypassword42@somehost.aws.com:5432/mydb
```

Alternatively, you can [configure the environment variable via the UI](https://vercel.com/docs/projects/environment-variables#declare-an-environment-variable) your project in the Vercel Dashboard.

#### Generate Prisma Client in `postinstall` hook

In your `package.json`, you should add a `"postinstall"` section as follows:

```js file=package.json
{
  // ...,
  "postinstall: "prisma generate"
}
```

#### Configure `experiments.asyncWebAssembly = true`

The edge-supporting version of Prisma Client uses Web Assembly. To avoid bundling problems, you should configure the following in your `next.config.js` (or in another location where you configure Webpack):

```js file=next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  webpack(config) {
    config.experiments ??= {}
    config.experiments.asyncWebAssembly = true

    return config
  },
}
module.exports = nextConfig
```

## Database-specific considerations & examples

This section provides database-specific instructions for deploying a Vercel Edge Functions with Prisma ORM.

### Prerequisites

As a prerequisite for the following section, you need to have a Vercel Edge Function (which typically comes in the form of a Next.js API route) running locally and the Prisma and Vercel CLIs installed. If you don't have that yet, you can run these commands to set up a Next.js app from scratch (following the instructions of the [Vercel Edge Quickstart](https://vercel.com/docs/functions/edge-functions/quickstart)):

```terminal
npm install -g vercel
npx create-next-app@latest
npm install prisma --save-dev
npx prisma init
```

We'll use the default `User` model for the example below:

```prisma
model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
}
```

### Deploying with Vercel Postgres

If you are using Vercel Postres, you need to:

- use the `@prisma/adapter-neon` database adapter (via the `driverAdapters` Preview feature) because Vercel Postgres uses [Neon]() under the hood
- be aware that Vercel by default calls the environment variable for the database connection string `POSTGRES_PRISMA_URL` while the default name used in the Prisma docs is typically `DATABASE_URL`; using Vercel's naming, you need to set the following fields on your `datasource` block:
  ```prisma
  datasource db {
    provider  = "postgresql"
    url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
    directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
  }
  ```

<details><summary>Expand if you want to view more</summary>

#### 1. Configure Prisma schema & database connection

First, ensure that database connection is configured properly. In your Prisma schema, set the `url` of the `datasource` block to the `POSTGRES_PRISMA_URL` and the `directUrl` to the `POSTGRES_URL_NON_POOLING` environment variable. You also need to enable the `driverAdapters` feature flag:

```prisma file=schema.prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}
```

Next, you need to set the `POSTGRES_PRISMA_URL` and `POSTGRES_URL_NON_POOLING` environment variable to the values of your database connection.

If you ran `npx prisma init`, you can use the `.env` file that was created by this command to set these:

```bash file=.env
POSTGRES_PRISMA_URL="postgres://user:password@host-pooler.region.postgres.vercel-storage.com:5432/name?pgbouncer=true&connect_timeout=15"
POSTGRES_URL_NON_POOLING="postgres://user:password@host.region.postgres.vercel-storage.com:5432/name"
```

Here is what the file might look like with some sample values that look similar to the values for Vercel Postgres database:

```bash file=.env
POSTGRES_PRISMA_URL="postgres://default:3vtEpyNbn6pl@ep-red-dew-a2fqe2pt-pooler.eu-central-1.postgres.vercel-storage.com:5432/verceldb?pgbouncer=true&connect_timeout=15"
POSTGRES_URL_NON_POOLING="postgres://default:3vtEpyNbn6pl@ep-red-dew-a2fqe2pt.eu-central-1.postgres.vercel-storage.com:5432/verceldb"
```

</details>

#### 2. Install dependencies

Next, install the required packages:

```terminal
npm install @prisma/adapter-neon
npm install @neondatabase/serverless
```

#### 3. Migrate your database schema (if applicable)

If you ran `npx prisma init` above, you need to migrate your database schema to create the `User` table that's defined in your Prisma schema (if you already have all the tables you need in your database, you can skip this step):

```terminal
npx prisma migrate dev --name init
```

#### 4. Use Prisma Client in your Vercel Edge Function to send a query to the database

If you created the project from scratch, you can create a new edge function as follows.

First, create a new API route, e.g. by using these commands:

```terminal
mkdir app/api
mkdir app/api/edge
touch app/api/edge/route.ts
```

Here is a sample code snippet that you can code to instantiate `PrismaClient` and send a query to your database in the new `app/api/edge/route.ts` file you just created:

```ts file=app/api/edge/route.ts
import { NextResponse } from 'next/server'
import { PrismaClient } from '@prisma/client/edge'
import { PrismaNeon } from '@prisma/adapter-neon'
import { Pool } from '@neondatabase/serverless'

export const runtime = 'edge'

export async function GET(request: Request) {
  const neon = new Pool({ connectionString: process.env.POSTGRES_PRISMA_URL })
  const adapter = new PrismaNeon(neon)
  const prisma = new PrismaClient({ adapter })

  const users = await prisma.user.findMany()

  return NextResponse.json(users, { status: 200 })
}
```

#### 6. Run the Worker locally

To run the Worker locally, you can run the `wrangler dev` command:

```terminal
npx wrangler dev
```

#### 7. Set the `DATABASE_URL` environment variable and deploy the worker

To deploy the worker, you first need to the `DATABASE_URL` environment variable [via the `wrangler` CLI](https://developers.cloudflare.com/workers/configuration/secrets/#secrets-on-deployed-workers):

```terminal
npx wrangler secret put DATABASE_URL postgresql://admin:mypassword42@somehost.aws.com:5432/mydb
```

Then you can go ahead then deploy the worker:

```terminal
npx wrangler deploy
```

### Deploying with a PlanetScale database

### Deploying with a Neon database

### Deploying with a PostgreSQL database
